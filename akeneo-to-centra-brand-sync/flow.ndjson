{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"scheduler-entry","identifier":"akeneo-fetch-brands","name":"Akeneo - Fetch - Brands","object":{"parameters":{"job":[{"prototype":"run-incoming","parameters":{"incoming":"akeneo-fetch-brands"}}],"handlers":[],"priority":2,"expression":"*/15 * * * *"}},"description":"","owner":null,"disabled":true}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"incoming-configuration","identifier":"akeneo-fetch-brands","name":"Akeneo - Fetch - Brands","object":{"parameters":{"subscriber":{"prototype":"http-subscriber","parameters":{"client":"akeneo-http-client","request":{"uri":"/api/rest/v1/reference-entities/${AKENEO_REFERENCE_ENTITY_BRANDS_CODE}/records","payload":[],"plugins":[],"payloadType":"data","authentications":[]},"pagination":{"prototype":"next","parameters":{"pattern":"_links.next","pageLimit":10000}},"deserializer":{"prototype":"json","parameters":{"pattern":"_embedded.items","readMethod":"wholeFile","encodeInput":false}},"requestListeners":[]}},"transformers":["akeneo-prepare-convert-brand-labels-to-localizations","akeneo-convert-brand-to-alumio-base","akeneo-filter-previous-brand"]}},"description":"","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"http-client","identifier":"akeneo-http-client","name":"Akeneo - HTTP Client","object":{"prototype":"akeneo-http-client-v2","parameters":{"key":"","baseUri":"${AKENEO_BASE_URL}","advanced":[],"clientId":"${AKENEO_CLIENT_ID}","password":"${AKENEO_PASSWORD}","username":"${AKENEO_USERNAME}","clientSecret":"${AKENEO_CLIENT_SECRET}","enableLogging":true,"loggerFormatter":"full"}},"description":"","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"list-transformer","identifier":"akeneo-prepare-convert-brand-labels-to-localizations","name":"Akeneo - Prepare convert - Brand labels - To localizations","object":{"meta":[],"prototype":"data","parameters":{"filters":[],"transformers":[{"meta":[],"prototype":"pattern-move","parameters":{"pattern":"values.image.0._links.download.href","conditions":[],"replacement":"image.uri"}},{"meta":[],"prototype":"pattern-move","parameters":{"pattern":"values.image.0.data","conditions":[],"replacement":"image.code"}},{"meta":[],"prototype":"value-remover","parameters":{"patterns":[{"key":"values.image"}]}},{"meta":[],"prototype":"list-transformer-wrapper","parameters":{"transformers":["akeneo-prepare-convert-values-to-localizations-and-custom-attributes"]}}]}},"description":"This is the transformer to convert labels data from Akeneo.","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"list-transformer","identifier":"akeneo-prepare-convert-values-to-localizations-and-custom-attributes","name":"Akeneo - Prepare convert - Values - To localizations and custom attributes","object":{"meta":[],"prototype":"chain","parameters":{"transformers":[{"meta":[],"prototype":"node","parameters":{"accessor":{"prototype":"pattern","parameters":{"keys":[],"pattern":"values.*.*"}},"nodeFilters":[],"nodeTransformers":[{"meta":[],"prototype":"conditional","parameters":{"filters":[{"prototype":"value-condition-v2","parameters":{"accessor":{"prototype":"pattern","parameters":{"keys":[],"pattern":"attribute_type"}},"conditions":[{"prototype":"equals","parameters":{"value":"pim_catalog_image"}}]}}],"elseCases":[],"transformers":[{"meta":[],"prototype":"value-remover","parameters":{"patterns":[{"key":"_links"}]}}],"elseTransformers":[]}},{"meta":[],"prototype":"value-setter","parameters":{"configurations":[{"key":"combinedKey","value":"locale:?{locale}|scope:?{scope}","mappers":[]}]}},{"meta":[],"prototype":"value-remover","parameters":{"patterns":[{"key":"attribute_type"},{"key":"reference_data_name"}]}},{"meta":[],"prototype":"value-filter","parameters":{"accessor":{"prototype":"key","parameters":{"keys":[]}},"conditions":[{"prototype":"logic-or","parameters":{"conditions":[{"prototype":"equals","parameters":{"value":[]}},{"prototype":"equals","parameters":{"value":null}}]}}]}}]}},{"meta":[],"prototype":"node","parameters":{"accessor":{"prototype":"pattern","parameters":{"keys":[],"pattern":"values.*"}},"nodeFilters":[],"nodeTransformers":[{"meta":[],"prototype":"accessor-move","parameters":{"source":{"prototype":"structure","parameters":{"key":"combinedKey","keys":[],"value":"\"\""}},"destination":{"prototype":"key","parameters":{"keys":[]}},"stripEnclosures":true}}]}},{"meta":[],"prototype":"data","parameters":{"filters":[],"transformers":[{"meta":[],"prototype":"pattern-move","parameters":{"pattern":"values.*.*","conditions":[],"replacement":"values.$2.$1"}},{"meta":[],"prototype":"value-filter","parameters":{"accessor":{"prototype":"key","parameters":{"keys":[],"root":"values"}},"conditions":[{"prototype":"logic-or","parameters":{"conditions":[{"prototype":"equals","parameters":{"value":[]}},{"prototype":"equals","parameters":{"value":null}}]}}]}},{"meta":[],"prototype":"value-remover","parameters":{"patterns":[{"key":"values.*.*.combinedKey"}]}}]}},{"meta":[],"prototype":"node","parameters":{"accessor":{"prototype":"pattern","parameters":{"keys":[],"pattern":"values.*"}},"nodeFilters":[],"nodeTransformers":[{"meta":[],"prototype":"pattern-move","parameters":{"pattern":"*.data","conditions":[],"replacement":"customAttributes.$1"}},{"meta":[],"prototype":"pattern-move","parameters":{"pattern":"*.scope","conditions":[],"replacement":"channelCode"}},{"meta":[],"prototype":"pattern-move","parameters":{"pattern":"*.locale","conditions":[],"replacement":"localeCode"}},{"meta":[],"prototype":"value-filter","parameters":{"accessor":{"prototype":"key","parameters":{"keys":[]}},"conditions":[{"prototype":"logic-or","parameters":{"conditions":[{"prototype":"equals","parameters":{"value":[]}},{"prototype":"equals","parameters":{"value":null}}]}}]}}]}},{"meta":[],"prototype":"data","parameters":{"filters":[],"transformers":[{"meta":[],"prototype":"pattern-move","parameters":{"pattern":"values.\"locale:|scope:\".customAttributes","conditions":[],"replacement":"customAttributes"}},{"meta":[],"prototype":"value-filter","parameters":{"accessor":{"prototype":"pattern","parameters":{"keys":[],"pattern":"values.*"}},"conditions":[{"prototype":"logic-or","parameters":{"conditions":[{"prototype":"equals","parameters":{"value":[]}},{"prototype":"equals","parameters":{"value":null}}]}}]}},{"meta":[],"prototype":"value-mapper","parameters":{"mappers":[{"prototype":"list-values","parameters":[]}],"accessor":{"prototype":"pattern","parameters":{"keys":[],"pattern":"values"}}}},{"meta":[],"prototype":"pattern-move","parameters":{"pattern":"values","conditions":[],"replacement":"localizations"}}]}}]}},"description":"This transformer will convert localizations data from Akeneo.","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"list-transformer","identifier":"akeneo-convert-brand-to-alumio-base","name":"Akeneo - Convert - Brand - to Alumio Base","object":{"meta":[],"prototype":"data","parameters":{"filters":[],"transformers":[{"meta":[],"prototype":"value-remover","parameters":{"patterns":[{"key":"_links"},{"key":"created"},{"key":"updated"}]}}]}},"description":"This is the transformer to convert the whole brands data into Alumio Base data.","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"list-transformer","identifier":"akeneo-filter-previous-brand","name":"Akeneo - Filter previous - Brand","object":{"meta":[],"prototype":"chain","parameters":{"transformers":[{"meta":[],"prototype":"type-setter","parameters":{"entityType":"base-brand"}},{"meta":[],"prototype":"storage-filter-stored-entity","parameters":{"storage":"akeneo-filter-previous-brands","addEntityToStorage":true}}]}},"description":"We use this transformer to filter previously created into task categories to avoid duplication","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"entity","identifier":"base-brand","name":"Base - Brand","object":{"parameters":{"schema":[],"identifierPath":["code"]}},"description":"","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"storage","identifier":"akeneo-filter-previous-brands","name":"Akeneo - Filter previous - Brands","object":{"parameters":{"path":"akeneo-filter-previous-brands-01K5E5YFN7E4PFY7KSPKSQ3ZJW","logger":{"parameters":{"actions":[]}}}},"description":"","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"scheduler-entry","identifier":"centra-send-brands","name":"Centra - Send - Brands","object":{"parameters":{"job":[{"prototype":"run-outgoing","parameters":{"route":"synchronize-brands-from-akeneo-to-centra","numTasks":1000,"enableUnlimitedTasks":false}}],"handlers":[],"priority":2,"expression":"*/15 * * * *"}},"description":"","owner":null,"disabled":true}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"route-configuration","identifier":"synchronize-brands-from-akeneo-to-centra","name":"Synchronize Brands from Akeneo to Centra","object":{"parameters":{"incoming":"akeneo-fetch-brands","outgoing":"centra-send-brand","realtime":false,"transformers":[],"waitingStatus":false,"parallelExecution":[]}},"description":"","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"outgoing-configuration","identifier":"centra-send-brand","name":"Centra - Send - Brand","object":{"parameters":{"publisher":{"prototype":"no-action-publisher","parameters":[]},"transformers":["centra-add-global-variables","centra-check-and-send-brand"]}},"description":"The task that was created through Incoming \"Akeneo - Fetch - Brands\" will then processed further by the Route \"Synchronize Brands from Akeneo to Centra\" and will be send using this Outgoing","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"list-transformer","identifier":"centra-add-global-variables","name":"Centra - Add global variables","object":{"meta":[],"prototype":"chain","parameters":{"transformers":[{"meta":[],"prototype":"data","parameters":{"filters":[],"transformers":[{"meta":[],"prototype":"value-setter","parameters":{"configurations":[{"key":"stores","value":[{"id":1}],"mappers":[]},{"key":"storeCategory","value":{"id":1},"mappers":[]},{"key":"status","value":"ACTIVE","mappers":[]}]}}]}}]}},"description":"Adding all data that you want added to Centra.","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"list-transformer","identifier":"centra-check-and-send-brand","name":"Centra - Check and send - Brand","object":{"meta":[],"prototype":"chain","parameters":{"transformers":[{"meta":[],"prototype":"data","parameters":{"filters":[],"transformers":[{"prototype":"storage-get-entity-from-storage","parameters":{"storage":"centra-brand-code-to-id","storageKey":"&{code}","destination":"id"}},{"prototype":"conditional","parameters":{"filters":[{"prototype":"and-condition","parameters":{"filters":[{"prototype":"key-condition","parameters":{"filter":{"prototype":"key-exists-condition","parameters":{"path":"id"}}}},{"prototype":"value-condition-v2","parameters":{"accessor":{"prototype":"pattern","parameters":{"keys":[],"pattern":"id"}},"conditions":[{"prototype":"not-equals","parameters":{"value":null}},{"prototype":"not-equals","parameters":{"value":[]}}]}}]}}],"elseCases":[],"transformers":[{"prototype":"graphql-transformer","parameters":{"client":"centra-http-client","request":{"uri":"/graphql","method":"post","payload":{"query":"mutation updateExistingBrand($id: Int, $input: BrandUpdateInput!) {\n\tupdateBrand(id: $id, input: $input) {\n\t  brand {\n\t    id\n\t    name\n\t    uri\n\t    availableInStores{\n\t      id\n\t      name\n\t    }\n\t    externalId\n\t  }\n    userErrors {message}\n    userWarnings {message}\n\t}\n}","variables":{"id":"&{id}","input":{"name":"&{(localizations[?localeCode=='en_US'].customAttributes.label | [0]) || (localizations[?localeCode=='en_GB'].customAttributes.label | [0]) || (localizations[].customAttributes.label | [0])}"}}}}}}],"elseTransformers":[{"prototype":"graphql-transformer","parameters":{"client":"centra-http-client","request":{"uri":"/graphql","method":"post","payload":{"query":"mutation createNewBrand($input: BrandCreateInput!) {\n\tcreateBrand(input: $input) {\n\t  brand {\n\t    id\n\t    name\n\t    uri\n\t    availableInStores{\n\t      id\n\t      name\n\t    }\n\t    externalId\n\t  }\n    userErrors {message}\n    userWarnings {message}\n\t}\n}","variables":{"input":{"uri":"&{code}","name":"&{(localizations[?localeCode=='en_US'].customAttributes.label | [0]) || (localizations[?localeCode=='en_GB'].customAttributes.label | [0]) || (localizations[].customAttributes.label | [0])}","externalId":"&{code}","addToStores":"&{stores}"}}}}}},{"prototype":"storage-save-entity-in-storage","parameters":{"source":"data.createBrand.brand.id","storage":"centra-brand-code-to-id","storageKey":"&{data.createBrand.brand.externalId}"}}]}}]}}]}},"description":"","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"storage","identifier":"centra-brand-code-to-id","name":"Centra - Brand - Code to id","object":{"parameters":{"path":"centra-brand-code-to-id-01K5H8C04JQJNBQT59MV1B7SYX","logger":{"parameters":{"actions":[]}}}},"description":"Map Akeneo reference entity record code into Centra Brand id","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"http-client","identifier":"centra-http-client","name":"Centra - HTTP Client","object":{"prototype":"centra-graphql-client","parameters":{"baseUri":"https://sandbox.centraqa.com","advanced":[],"apiToken":"${CENTRA_API_TOKEN}","enableLogging":true,"loggerFormatter":"full"}},"description":"","owner":null,"disabled":false}